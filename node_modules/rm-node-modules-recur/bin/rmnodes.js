#!/usr/bin/env node
var fs = require('fs')
var path = require('path')
var args =  process.argv;
const arg = args[2];
if(!arg) return console.error('please input a root dir!')
function traversal(dir){
  let dirs = fs.readdirSync(dir);
  let md = path.resolve(dir,'node_modules')
  let ext = fs.existsSync(md)
  if(ext)	{
    console.log(`${md} is dir, deleting node_modules...` );
    deleteFolderRecursive(md);
  }
	dirs.forEach(dir2=>{
		let stat = fs.statSync(path.resolve(dir,dir2));
    let isDirectory = stat.isDirectory();
		if(isDirectory){
			const md = path.resolve(dir,dir2,'node_modules')
			let ext = fs.existsSync(md)
			if(ext)	{
        console.log(`${path.resolve(dir,dir2)} is dir, deleting node_modules...` );
        deleteFolderRecursive(md)
      }
			traversal(path.resolve(dir,dir2))
		}
	})
}
var deleteFolderRecursive = function(path) {
  if( fs.existsSync(path) ) {
      fs.readdirSync(path).forEach(function(file) {
        var curPath = path + "/" + file;
          if(fs.lstatSync(curPath).isDirectory()) { 
              deleteFolderRecursive(curPath);
          } else {  
              fs.unlinkSync(curPath);
          }
      });
      fs.rmdirSync(path);
    }
};
traversal(arg)